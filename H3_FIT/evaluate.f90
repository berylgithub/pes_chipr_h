!######################################################################################################
! caller (evaluator):
!% For diatomics:
!CALL CHIPR_DIAT(R,POT,DER,DVDR) 
!% For three-body energies
!CALL CHIPR_TRIAT(R,POT,DER,DVDR) 
!% For four-body energies
!CALL CHIPR_TETRA(R,POT,DER,DVDR)

program evaluator
    IMPLICIT NONE  
    DOUBLE PRECISION, DIMENSION(:,:), ALLOCATABLE :: R_array
    DOUBLE PRECISION, DIMENSION(:), ALLOCATABLE :: POT_array
    DOUBLE PRECISION, DIMENSION(3) :: DVDR = 0.0
    LOGICAL :: DER = .false.
    INTEGER :: i, nlines

    !load R from file:
    nlines = 0
    open (1, file = 'abinitio_data.txt')
    do
        read (1,*, END=10)
        nlines = nlines + 1
    end do
    10 close (1)

    ALLOCATE(R_array(nlines, 3)) !triatomic, R shape = (n, 3)
    ALLOCATE(POT_array(nlines))

    open (1, file = 'abinitio_data.txt')
    do i=1, nlines
        read(1,*) R_array(i, :), POT_array(i)
    end do
    close (1)

    !evaluate each point:
    do i=1, nlines
        call CHIPR_TRIAT(R_array(i, :), POT_array(i), DER, DVDR)
    end do

    !save evaluated points to file:
    open(1, file = "h3_evaluation.txt")
    do i=1, nlines
        write(1, *) R_array(i, :), POT_array(i)
    end do
    close(1)

end program evaluator
!######################################################################################################

      SUBROUTINE CHIPR_TRIAT(R,POT,DER,DVDR)
      IMPLICIT NONE
      CHARACTER(LEN=3), PARAMETER :: MOLTYP="A3"
      INTEGER, PARAMETER :: DEG=1
      INTEGER, PARAMETER :: NC=705
      INTEGER, PARAMETER :: NX=3
      INTEGER :: I,J,K,L,M,S,O,ID
      INTEGER :: POLORDER
      INTEGER, DIMENSION(DEG) :: BSORDER,NCBAS
      DOUBLE PRECISION, DIMENSION(NC) :: C
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: POL,BS
      DOUBLE PRECISION, DIMENSION(3) :: R
      DOUBLE PRECISION :: POT,REPDAMP
      INTEGER :: NCPOL,NCTOTAL,SUMC
      DOUBLE PRECISION, DIMENSION(NX) :: Y
      INTEGER :: TOTNUM,MNUM
      INTEGER, DIMENSION(3,6) :: P
      LOGICAL :: DER
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: DVDY1
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: DVDY2
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: DVDY3
      DOUBLE PRECISION, DIMENSION(NX) :: DVDR,DYDR

      C(  1)=  0.35826043060056633748899912461638451D+03
      C(  2)=  0.43863275651365811427240259945392609D+04
      C(  3)= -0.16968411133784364210441708564758301D+05
      C(  4)= -0.15819232088801701320335268974304199D+06
      C(  5)= -0.17355385645600591669790446758270264D+06
      C(  6)=  0.54937484482132783159613609313964844D+06
      C(  7)=  0.16590259405753656756132841110229492D+07
      C(  8)=  0.41633606508064363151788711547851562D+07
      C(  9)= -0.37367140691597396507859230041503906D+07
      C( 10)= -0.44055917126620290800929069519042969D+07
      C( 11)= -0.10356958900609835982322692871093750D+08
      C( 12)= -0.26930865395296953618526458740234375D+08
      C( 13)= -0.17060615101148623973131179809570312D+08
      C( 14)=  0.18887576168582208454608917236328125D+08
      C( 15)=  0.42642643633865937590599060058593750D+08
      C( 16)=  0.92859564964354820549488067626953125D+07
      C( 17)=  0.43437406145833827555179595947265625D+08
      C( 18)=  0.10629931323129749298095703125000000D+09
      C( 19)=  0.15943669063874569535255432128906250D+09
      C( 20)= -0.71652059629612788558006286621093750D+08
      C( 21)= -0.14586259509092932939529418945312500D+09
      C( 22)= -0.73771976734761580824851989746093750D+08
      C( 23)= -0.97548036331178203225135803222656250D+08
      C( 24)= -0.12464718160753272473812103271484375D+09
      C( 25)= -0.23954832276938647031784057617187500D+09
      C( 26)= -0.49105777386017298698425292968750000D+09
      C( 27)= -0.23234469970394805073738098144531250D+09
      C( 28)=  0.19426318910966780781745910644531250D+09
      C( 29)=  0.34235446220674705505371093750000000D+09
      C( 30)=  0.33604800325384658575057983398437500D+09
      C( 31)=  0.28919661210178315639495849609375000D+09
      C( 32)=  0.18296624460814771056175231933593750D+09
      C( 33)=  0.21736698325902965664863586425781250D+09
      C( 34)=  0.23737326237882268428802490234375000D+09
      C( 35)=  0.87584645498962342739105224609375000D+09
      C( 36)=  0.82983777462563943862915039062500000D+09
      C( 37)= -0.33211297459195941686630249023437500D+09
      C( 38)= -0.51430245849748593568801879882812500D+09
      C( 39)= -0.31395502951954835653305053710937500D+09
      C( 40)= -0.30008193886284875869750976562500000D+09
      C( 41)= -0.70736927924925279617309570312500000D+09
      C( 42)= -0.55038022040997707843780517578125000D+09
      C( 43)=  0.55134406499004773795604705810546875D+08
      C( 44)= -0.10131927331863407790660858154296875D+09
      C( 45)=  0.57998074264342442154884338378906250D+08
      C( 46)= -0.46637617034165346622467041015625000D+09
      C( 47)= -0.87434837720492851734161376953125000D+09
      C( 48)= -0.25699439122128531336784362792968750D+08
      C( 49)=  0.21292538911817932128906250000000000D+09
      C( 50)=  0.44586605237701505422592163085937500D+09
      C( 51)= -0.33076595494544190168380737304687500D+09
      C( 52)=  0.32287134653470128774642944335937500D+09
      C( 53)=  0.11508795653631098270416259765625000D+10
      C( 54)=  0.41648333271600151062011718750000000D+09
      C( 55)=  0.44922980951857465505599975585937500D+09
      C( 56)= -0.88507480879941260814666748046875000D+09
      C( 57)= -0.35963729056608289480209350585937500D+09
      C( 58)= -0.24228868632143333554267883300781250D+09
      C( 59)= -0.76143761234511196613311767578125000D+09
      C( 60)= -0.18304610736476171016693115234375000D+09
      C( 61)= -0.11798848915613534450531005859375000D+10
      C( 62)=  0.31588891660911190509796142578125000D+09
      C( 63)= -0.22728058362259078025817871093750000D+09
      C( 64)=  0.95269735620955085754394531250000000D+09
      C( 65)=  0.33200840426688915491104125976562500D+09
      C( 66)=  0.84020005039668887853622436523437500D+08
      C( 67)= -0.49888703288282030820846557617187500D+09
      C( 68)=  0.41207461218728400766849517822265625D+08
      C( 69)= -0.41527089945857375860214233398437500D+09
      C( 70)=  0.17075878540665056705474853515625000D+10
      C( 71)=  0.10363579098503732681274414062500000D+10
      C( 72)=  0.33976045228090173006057739257812500D+09
      C( 73)=  0.81660515373611673712730407714843750D+08
      C( 74)=  0.29035292596025174856185913085937500D+09
      C( 75)=  0.13420822438504550457000732421875000D+10
      C( 76)=  0.10751490216401553153991699218750000D+10
      C( 77)=  0.65406235331448936462402343750000000D+09
      C( 78)= -0.35201824441515302658081054687500000D+09
      C( 79)= -0.15687985699745917320251464843750000D+09
      C( 80)= -0.36535804835805416107177734375000000D+08
      C( 81)=  0.25297007478036209940910339355468750D+09
      C( 82)= -0.10192950526175206899642944335937500D+09
      C( 83)= -0.11622014791590116024017333984375000D+10
      C( 84)= -0.69914241190724813938140869140625000D+09
      C( 85)= -0.18937463782199947834014892578125000D+10
      C( 86)=  0.45175642668252736330032348632812500D+09
      C( 87)= -0.15921208658465223312377929687500000D+10
      C( 88)=  0.60046583114163792133331298828125000D+09
      C( 89)= -0.38708174439653915166854858398437500D+09
      C( 90)=  0.79969461949370658397674560546875000D+09
      C( 91)= -0.50561141316818960011005401611328125D+08
      C( 92)=  0.13458472773100955486297607421875000D+10
      C( 93)=  0.55050452124685072898864746093750000D+09
      C( 94)=  0.31258435434575802087783813476562500D+09
      C( 95)=  0.17557659051633827686309814453125000D+10
      C( 96)= -0.76715666818393504619598388671875000D+09
      C( 97)=  0.66901371730316603183746337890625000D+09
      C( 98)= -0.79016040877573168277740478515625000D+09
      C( 99)= -0.91701761880334150791168212890625000D+09
      C(100)= -0.12304470813840203285217285156250000D+10
      C(101)=  0.44243814915343183279037475585937500D+09
      C(102)=  0.42227280224450266361236572265625000D+09
      C(103)=  0.19116364030959534645080566406250000D+10
      C(104)= -0.10569115098721804618835449218750000D+10
      C(105)=  0.63505629179704201221466064453125000D+09
      C(106)= -0.63207185372643578052520751953125000D+09
      C(107)= -0.12241514650168802738189697265625000D+10
      C(108)=  0.22460644719214031100273132324218750D+09
      C(109)= -0.27349370074188413619995117187500000D+10
      C(110)= -0.33684865246903860569000244140625000D+09
      C(111)= -0.33143646997045439481735229492187500D+09
      C(112)=  0.32129110031875598430633544921875000D+09
      C(113)= -0.12402897956729032993316650390625000D+10
      C(114)= -0.16507276508364868164062500000000000D+10
      C(115)= -0.14018085537982032299041748046875000D+10
      C(116)= -0.73763806464478933811187744140625000D+09
      C(117)=  0.26770084678505861759185791015625000D+09
      C(118)=  0.54160715771120536327362060546875000D+09
      C(119)= -0.10775718915537104606628417968750000D+10
      C(120)= -0.12907529538467891514301300048828125D+09
      C(121)= -0.14007580849345605373382568359375000D+10
      C(122)= -0.44644456284398472309112548828125000D+09
      C(123)=  0.70569646426054120063781738281250000D+09
      C(124)=  0.22182681780761351585388183593750000D+10
      C(125)=  0.26606757519635176658630371093750000D+10
      C(126)= -0.12493180235468186438083648681640625D+08
      C(127)=  0.10629505286536458730697631835937500D+10
      C(128)=  0.22696378426644010543823242187500000D+10
      C(129)=  0.85295938149931526184082031250000000D+09
      C(130)= -0.40873809470379078388214111328125000D+09
      C(131)=  0.11565427965623812675476074218750000D+10
      C(132)= -0.12058098654226839542388916015625000D+10
      C(133)= -0.19967205146865389347076416015625000D+10
      C(134)=  0.40062384829169726371765136718750000D+09
      C(135)= -0.13143645342459032535552978515625000D+10
      C(136)= -0.24893140918656110763549804687500000D+10
      C(137)= -0.10360092192357625961303710937500000D+10
      C(138)= -0.10403227024832409620285034179687500D+10
      C(139)= -0.34957786313985714912414550781250000D+10
      C(140)=  0.18194579945626025199890136718750000D+10
      C(141)= -0.52505938180218923091888427734375000D+09
      C(142)= -0.62573812057402539253234863281250000D+09
      C(143)=  0.91264801464015924930572509765625000D+09
      C(144)=  0.18347530013108716011047363281250000D+10
      C(145)=  0.57150095905778086185455322265625000D+09
      C(146)= -0.29266081731074506044387817382812500D+09
      C(147)=  0.94842462284608483314514160156250000D+08
      C(148)= -0.27928972110781645774841308593750000D+10
      C(149)=  0.32200021847402291297912597656250000D+10
      C(150)= -0.17039346961265242099761962890625000D+09
      C(151)= -0.10866265613977125287055969238281250D+09
      C(152)= -0.47808026509603744745254516601562500D+09
      C(153)=  0.31049979566809779405593872070312500D+09
      C(154)= -0.12461547835983533859252929687500000D+10
      C(155)= -0.52234270229940366744995117187500000D+09
      C(156)=  0.44082103644073553085327148437500000D+10
      C(157)=  0.36961819906021165847778320312500000D+10
      C(158)=  0.23485249440844478607177734375000000D+10
      C(159)= -0.11848477377442204952239990234375000D+10
      C(160)=  0.12207839683812186717987060546875000D+10
      C(161)= -0.10767452328723292350769042968750000D+10
      C(162)= -0.62771302140484404563903808593750000D+09
      C(163)=  0.79804172495685279369354248046875000D+09
      C(164)=  0.19617246937864360809326171875000000D+10
      C(165)=  0.21212021360157983303070068359375000D+10
      C(166)= -0.27929209032022247314453125000000000D+10
      C(167)=  0.11760940881069979667663574218750000D+10
      C(168)= -0.18776035392027041912078857421875000D+10
      C(169)=  0.17309275664510407447814941406250000D+10
      C(170)=  0.93911828670344281196594238281250000D+09
      C(171)=  0.30665812832302002906799316406250000D+10
      C(172)=  0.29797486439925951957702636718750000D+10
      C(173)=  0.13302905531069173812866210937500000D+10
      C(174)=  0.14110602860807478427886962890625000D+10
      C(175)= -0.72036275882736158370971679687500000D+10
      C(176)=  0.85825848900993430614471435546875000D+09
      C(177)= -0.26392717275541472434997558593750000D+10
      C(178)= -0.14224749125780184268951416015625000D+10
      C(179)=  0.15746920880580689907073974609375000D+10
      C(180)= -0.39759490698701648712158203125000000D+10
      C(181)= -0.34076362908825526237487792968750000D+10
      C(182)= -0.58273903399048671722412109375000000D+10
      C(183)= -0.37893259471741026639938354492187500D+09
      C(184)=  0.75016335851787137985229492187500000D+09
      C(185)=  0.28194467532933444976806640625000000D+10
      C(186)=  0.45034861664935560226440429687500000D+10
      C(187)=  0.14868271842000718116760253906250000D+10
      C(188)=  0.31802744264883184432983398437500000D+10
      C(189)=  0.15655963917886631563305854797363281D+08
      C(190)=  0.63341720663383930921554565429687500D+08
      C(191)=  0.37908801801463961601257324218750000D+10
      C(192)=  0.36663064080681605339050292968750000D+10
      C(193)= -0.28569147773841345310211181640625000D+09
      C(194)=  0.72333665999311056137084960937500000D+10
      C(195)=  0.44578670543526802062988281250000000D+10
      C(196)= -0.23950772707960410118103027343750000D+10
      C(197)= -0.29853489030639791488647460937500000D+10
      C(198)=  0.44034064430831127166748046875000000D+10
      C(199)=  0.65437753157039201259613037109375000D+09
      C(200)=  0.39203638836153829097747802734375000D+09
      C(201)= -0.22544027465856862068176269531250000D+09
      C(202)=  0.69006422620389103889465332031250000D+09
      C(203)=  0.17017378277739839553833007812500000D+10
      C(204)=  0.34019189353801274299621582031250000D+10
      C(205)= -0.59023602943258123397827148437500000D+10
      C(206)=  0.16180640987418894767761230468750000D+10
      C(207)= -0.39823412545323762893676757812500000D+10
      C(208)= -0.48490313915437021255493164062500000D+10
      C(209)=  0.25647885753775129318237304687500000D+10
      C(210)=  0.45018665621256756782531738281250000D+09
      C(211)= -0.10556465418936164379119873046875000D+10
      C(212)= -0.87804574419671382904052734375000000D+10
      C(213)= -0.30980411250861740112304687500000000D+10
      C(214)=  0.40174839131085510253906250000000000D+10
      C(215)= -0.10097545162972216606140136718750000D+10
      C(216)= -0.20916294057179155349731445312500000D+10
      C(217)=  0.16885401122051553726196289062500000D+10
      C(218)= -0.42136925068085465431213378906250000D+10
      C(219)= -0.70272193638379278182983398437500000D+10
      C(220)=  0.66580129808988485336303710937500000D+10
      C(221)= -0.24470334191230220794677734375000000D+10
      C(222)= -0.42201431634665983915328979492187500D+09
      C(223)=  0.44896171239772539138793945312500000D+10
      C(224)=  0.66744607375757627487182617187500000D+10
      C(225)= -0.62043673399371910095214843750000000D+10
      C(226)=  0.19078207511902220249176025390625000D+10
      C(227)=  0.52316322988257350921630859375000000D+10
      C(228)=  0.53407910876471242904663085937500000D+10
      C(229)= -0.48787439291022539138793945312500000D+10
      C(230)= -0.18200319540345447063446044921875000D+10
      C(231)=  0.35625860516318774223327636718750000D+10
      C(232)= -0.11729511314368498325347900390625000D+10
      C(233)= -0.27375987628690276145935058593750000D+10
      C(234)= -0.58921300848541078567504882812500000D+10
      C(235)= -0.62430974533600502014160156250000000D+10
      C(236)= -0.16990601240941007137298583984375000D+10
      C(237)=  0.17987580307175436019897460937500000D+10
      C(238)= -0.14913074054102284908294677734375000D+10
      C(239)=  0.48612117011522102355957031250000000D+10
      C(240)=  0.11662276679694106578826904296875000D+10
      C(241)= -0.40249011041359052658081054687500000D+10
      C(242)= -0.81846463549412024021148681640625000D+09
      C(243)=  0.41523745308440237045288085937500000D+10
      C(244)=  0.90694766378713741302490234375000000D+10
      C(245)=  0.74032017242564878463745117187500000D+10
      C(246)= -0.20006430872044456005096435546875000D+10
      C(247)= -0.41075183226886138916015625000000000D+10
      C(248)=  0.33448446984712300300598144531250000D+10
      C(249)=  0.61703534407426195144653320312500000D+10
      C(250)= -0.52067453424337792396545410156250000D+09
      C(251)= -0.12743266603933763504028320312500000D+10
      C(252)=  0.93366177345074760913848876953125000D+09
      C(253)= -0.47275225527572784423828125000000000D+10
      C(254)= -0.87197195627721443176269531250000000D+10
      C(255)= -0.14232098634224142074584960937500000D+11
      C(256)=  0.11553939518016369342803955078125000D+10
      C(257)= -0.19330356889242751598358154296875000D+10
      C(258)= -0.73175634834641647338867187500000000D+09
      C(259)= -0.33371617652116942405700683593750000D+10
      C(260)=  0.51630434734847965240478515625000000D+10
      C(261)= -0.88463108154433422088623046875000000D+10
      C(262)= -0.47121515255036725997924804687500000D+10
      C(263)= -0.38759852691614179611206054687500000D+10
      C(264)= -0.30170172460103120803833007812500000D+10
      C(265)= -0.98323223971452701091766357421875000D+09
      C(266)=  0.47277618329629383087158203125000000D+10
      C(267)= -0.14029932548588988780975341796875000D+10
      C(268)= -0.60006150848861045837402343750000000D+10
      C(269)= -0.43740100347482671737670898437500000D+10
      C(270)= -0.43841529868000421524047851562500000D+10
      C(271)= -0.85945942703720760345458984375000000D+10
      C(272)= -0.72680087399874877929687500000000000D+10
      C(273)= -0.35415848015662870407104492187500000D+10
      C(274)= -0.42533725583703351020812988281250000D+10
      C(275)=  0.20535554829587612152099609375000000D+10
      C(276)=  0.20965125291076223850250244140625000D+10
      C(277)=  0.75853246990655288696289062500000000D+10
      C(278)=  0.76043088932125616073608398437500000D+10
      C(279)=  0.47052997073159044981002807617187500D+09
      C(280)= -0.43417458038265407085418701171875000D+08
      C(281)=  0.92088839739146804809570312500000000D+10
      C(282)=  0.56781109226769733428955078125000000D+10
      C(283)=  0.80942167927908782958984375000000000D+10
      C(284)=  0.21740973944350104331970214843750000D+10
      C(285)= -0.21364269387310028076171875000000000D+09
      C(286)=  0.13765536047194621562957763671875000D+10
      C(287)=  0.10119011547498579025268554687500000D+11
      C(288)=  0.61850241265440311431884765625000000D+10
      C(289)= -0.80324178177064943313598632812500000D+09
      C(290)= -0.12495050790381793975830078125000000D+10
      C(291)=  0.19551374872787718772888183593750000D+10
      C(292)= -0.10487632551254631578922271728515625D+09
      C(293)=  0.44329603894703501462936401367187500D+09
      C(294)=  0.99552430376312232017517089843750000D+09
      C(295)= -0.14473659180279153823852539062500000D+11
      C(296)=  0.30641908430042977333068847656250000D+10
      C(297)=  0.41466803098041453361511230468750000D+10
      C(298)= -0.12807301859009508132934570312500000D+11
      C(299)= -0.33362970760302319526672363281250000D+10
      C(300)= -0.67487767001277294158935546875000000D+10
      C(301)= -0.25662787518559706211090087890625000D+09
      C(302)= -0.55629503355119524002075195312500000D+10
      C(303)= -0.11935988058950080871582031250000000D+11
      C(304)= -0.14158112911236675262451171875000000D+11
      C(305)=  0.78667283165994396209716796875000000D+10
      C(306)=  0.14176586453603845596313476562500000D+11
      C(307)= -0.52238628070779790878295898437500000D+10
      C(308)= -0.92066193572896938323974609375000000D+10
      C(309)= -0.48766562590773286819458007812500000D+10
      C(310)=  0.52754561242665214538574218750000000D+10
      C(311)=  0.26488882603775377273559570312500000D+10
      C(312)= -0.26298052066758308410644531250000000D+10
      C(313)= -0.22111889121332684159278869628906250D+09
      C(314)= -0.10012013085221612930297851562500000D+11
      C(315)=  0.87332995006181640625000000000000000D+10
      C(316)= -0.95348606856318607330322265625000000D+10
      C(317)=  0.39338818408857812881469726562500000D+10
      C(318)=  0.21069797205661735534667968750000000D+11
      C(319)=  0.97627108068579463958740234375000000D+10
      C(320)= -0.91530131679331934452056884765625000D+09
      C(321)= -0.25287334648671784400939941406250000D+10
      C(322)= -0.16873270747634425163269042968750000D+10
      C(323)= -0.17856677250812290191650390625000000D+11
      C(324)=  0.59371614345644826889038085937500000D+10
      C(325)=  0.82499310099595708847045898437500000D+10
      C(326)= -0.18872984817141375541687011718750000D+10
      C(327)= -0.23200398156727256774902343750000000D+10
      C(328)= -0.61594635541382236480712890625000000D+10
      C(329)=  0.37296666353130011558532714843750000D+10
      C(330)= -0.34550389521488232612609863281250000D+10
      C(331)= -0.53106706381898059844970703125000000D+10
      C(332)= -0.28045763072260136604309082031250000D+10
      C(333)=  0.30993584646220350265502929687500000D+10
      C(334)=  0.54649436685752925872802734375000000D+10
      C(335)=  0.11443868432247648239135742187500000D+11
      C(336)=  0.19328656914328628540039062500000000D+11
      C(337)=  0.25300343529837600708007812500000000D+11
      C(338)= -0.22162717106836257934570312500000000D+11
      C(339)=  0.53068839449481716156005859375000000D+10
      C(340)=  0.11444528562560249328613281250000000D+11
      C(341)= -0.84271965053941240310668945312500000D+10
      C(342)= -0.10913207633060440063476562500000000D+11
      C(343)= -0.19072777449284372329711914062500000D+10
      C(344)=  0.10630259666631361007690429687500000D+11
      C(345)=  0.56439926607224407196044921875000000D+10
      C(346)= -0.28661217601675963401794433593750000D+10
      C(347)= -0.11050861286131767272949218750000000D+11
      C(348)=  0.10627752865752460479736328125000000D+11
      C(349)=  0.13541252221317234039306640625000000D+11
      C(350)= -0.50688197294876403808593750000000000D+10
      C(351)= -0.16503361212349617481231689453125000D+10
      C(352)= -0.18214666041787731647491455078125000D+10
      C(353)=  0.14199329964885494232177734375000000D+11
      C(354)=  0.15927129109305730819702148437500000D+11
      C(355)=  0.86500023887034187316894531250000000D+10
      C(356)=  0.11064705237192781448364257812500000D+11
      C(357)=  0.14771216103707633972167968750000000D+11
      C(358)= -0.12088327069612699508666992187500000D+11
      C(359)=  0.26627903816273590087890625000000000D+11
      C(360)= -0.18352040623105472564697265625000000D+11
      C(361)= -0.96595520761016807556152343750000000D+10
      C(362)=  0.20785585604600807189941406250000000D+11
      C(363)=  0.99507808054085006713867187500000000D+10
      C(364)= -0.32476637502678890228271484375000000D+10
      C(365)= -0.11268923766021926403045654296875000D+10
      C(366)= -0.82225322595417890548706054687500000D+10
      C(367)= -0.45803568541004737854003906250000000D+11
      C(368)= -0.58040207368638782501220703125000000D+10
      C(369)=  0.45712088136379995346069335937500000D+10
      C(370)= -0.88057975022248363494873046875000000D+10
      C(371)= -0.30522669820195813179016113281250000D+10
      C(372)=  0.63829265947309026718139648437500000D+10
      C(373)= -0.29388430224063983917236328125000000D+11
      C(374)= -0.66741763491868600845336914062500000D+10
      C(375)= -0.14613800043210283279418945312500000D+11
      C(376)= -0.15829190942121219635009765625000000D+11
      C(377)= -0.20520629151091089248657226562500000D+10
      C(378)= -0.54841563769680919647216796875000000D+10
      C(379)= -0.32814208701162652969360351562500000D+10
      C(380)=  0.73154102669929456710815429687500000D+10
      C(381)=  0.14401055089967903137207031250000000D+11
      C(382)=  0.14575566473741214752197265625000000D+11
      C(383)=  0.23287834963252750396728515625000000D+11
      C(384)=  0.26691843722421352386474609375000000D+11
      C(385)=  0.83451730349994335174560546875000000D+10
      C(386)= -0.44133974745854921340942382812500000D+10
      C(387)=  0.47482282651620540618896484375000000D+10
      C(388)=  0.14237458938252132415771484375000000D+11
      C(389)= -0.70228535557878160476684570312500000D+10
      C(390)=  0.82704677758617486953735351562500000D+10
      C(391)=  0.13782831328244466781616210937500000D+11
      C(392)=  0.67501674957593345642089843750000000D+10
      C(393)=  0.12352179742356235504150390625000000D+11
      C(394)=  0.12915396654714723587036132812500000D+11
      C(395)=  0.10184014942917314529418945312500000D+11
      C(396)= -0.30588151512445950508117675781250000D+10
      C(397)= -0.11965830179452857971191406250000000D+11
      C(398)= -0.77634691239408502578735351562500000D+10
      C(399)=  0.16166469909310495376586914062500000D+11
      C(400)=  0.86237197382646656036376953125000000D+10
      C(401)=  0.15892099709126905441284179687500000D+11
      C(402)=  0.10149541370180982589721679687500000D+11
      C(403)=  0.15020403453518893718719482421875000D+10
      C(404)=  0.11043719548967023849487304687500000D+11
      C(405)=  0.25016612681390895843505859375000000D+11
      C(406)= -0.14369760782408096313476562500000000D+11
      C(407)=  0.49266812837776885986328125000000000D+11
      C(408)= -0.11617735563797956466674804687500000D+11
      C(409)= -0.16167534440590555191040039062500000D+11
      C(410)=  0.61997375537279443740844726562500000D+10
      C(411)= -0.15679498748847187042236328125000000D+11
      C(412)= -0.28800599737002094268798828125000000D+11
      C(413)= -0.11113893500434251785278320312500000D+11
      C(414)=  0.26568058608991007804870605468750000D+10
      C(415)=  0.31040807139487729072570800781250000D+10
      C(416)= -0.40776078920025962829589843750000000D+11
      C(417)=  0.50299680012955989837646484375000000D+10
      C(418)=  0.38215792793661727905273437500000000D+10
      C(419)= -0.24107312321121963500976562500000000D+11
      C(420)= -0.10304886001085615158081054687500000D+11
      C(421)=  0.24430821636479011535644531250000000D+11
      C(422)= -0.15554879808547796249389648437500000D+11
      C(423)=  0.62841127559065361022949218750000000D+10
      C(424)= -0.17788063781667610168457031250000000D+11
      C(425)= -0.27716570732607421875000000000000000D+11
      C(426)= -0.27131620938583607673645019531250000D+10
      C(427)=  0.16170588940851160049438476562500000D+11
      C(428)=  0.77901342650026929378509521484375000D+09
      C(429)= -0.84484814491797065734863281250000000D+10
      C(430)= -0.66159148335144615173339843750000000D+10
      C(431)=  0.26528794634660372734069824218750000D+10
      C(432)= -0.93326696131325924396514892578125000D+09
      C(433)= -0.84540928884397230148315429687500000D+10
      C(434)= -0.14765536168918855667114257812500000D+11
      C(435)= -0.29389797157226985931396484375000000D+11
      C(436)=  0.68503893393094841003417968750000000D+11
      C(437)= -0.17784441103815097808837890625000000D+11
      C(438)= -0.26964350886127899169921875000000000D+11
      C(439)=  0.34751690900149841308593750000000000D+11
      C(440)= -0.15681117141595699787139892578125000D+10
      C(441)=  0.24271445622794071197509765625000000D+11
      C(442)=  0.64783953797931213378906250000000000D+10
      C(443)= -0.20698107270224647521972656250000000D+11
      C(444)=  0.10215619482273607254028320312500000D+10
      C(445)=  0.24307550167020927429199218750000000D+11
      C(446)=  0.29035182357325687408447265625000000D+11
      C(447)= -0.21661643175520832061767578125000000D+11
      C(448)= -0.43830723236046020507812500000000000D+11
      C(449)= -0.18806558268035465240478515625000000D+11
      C(450)=  0.23879507680684410095214843750000000D+11
      C(451)=  0.14941345152917278289794921875000000D+11
      C(452)=  0.11415065443739805221557617187500000D+11
      C(453)= -0.15230949306036861419677734375000000D+11
      C(454)= -0.29672579897024452209472656250000000D+11
      C(455)= -0.15158968117686553955078125000000000D+11
      C(456)=  0.45091489715170326232910156250000000D+10
      C(457)=  0.13100434066191074371337890625000000D+11
      C(458)= -0.15700406353843151092529296875000000D+11
      C(459)=  0.45438430140887985229492187500000000D+11
      C(460)= -0.77814061827928745746612548828125000D+09
      C(461)= -0.43533969065888042449951171875000000D+10
      C(462)= -0.64718498052864398956298828125000000D+10
      C(463)= -0.49651783198485122680664062500000000D+11
      C(464)= -0.65814704719123687744140625000000000D+11
      C(465)= -0.41339710806783874511718750000000000D+11
      C(466)= -0.11583951199810197830200195312500000D+11
      C(467)=  0.93944143195425662994384765625000000D+10
      C(468)=  0.90328035749170742034912109375000000D+10
      C(469)=  0.57504407436719764709472656250000000D+11
      C(470)=  0.28251288287726127624511718750000000D+11
      C(471)= -0.20648951264596557617187500000000000D+11
      C(472)= -0.14913558582645521163940429687500000D+11
      C(473)=  0.29965461584932380676269531250000000D+11
      C(474)=  0.55251377843829559326171875000000000D+11
      C(475)=  0.51350754832085762023925781250000000D+11
      C(476)=  0.52165507553206588745117187500000000D+11
      C(477)=  0.65222098574161939620971679687500000D+10
      C(478)= -0.21965387321606723785400390625000000D+11
      C(479)= -0.59902140400406408309936523437500000D+10
      C(480)=  0.22461703563732597351074218750000000D+11
      C(481)=  0.32213859755586429595947265625000000D+11
      C(482)=  0.14214449170883991241455078125000000D+11
      C(483)= -0.69958469453726899623870849609375000D+09
      C(484)= -0.75179566561470613479614257812500000D+10
      C(485)= -0.74980847108587713241577148437500000D+10
      C(486)=  0.16122210445278829574584960937500000D+11
      C(487)= -0.14846193010545948028564453125000000D+11
      C(488)= -0.48944461008922378540039062500000000D+11
      C(489)= -0.69216138542562408447265625000000000D+11
      C(490)= -0.10037687861898200988769531250000000D+12
      C(491)=  0.39713177156890480041503906250000000D+11
      C(492)=  0.50268949147409849166870117187500000D+10
      C(493)= -0.46236917904521575927734375000000000D+11
      C(494)=  0.26493947446424846649169921875000000D+11
      C(495)= -0.25926463060789253234863281250000000D+11
      C(496)=  0.27923596705431121826171875000000000D+11
      C(497)= -0.22122783901431093215942382812500000D+10
      C(498)= -0.48981651173495666503906250000000000D+11
      C(499)= -0.19671094895440956115722656250000000D+11
      C(500)=  0.71957924816933479309082031250000000D+10
      C(501)=  0.84375292244031298160552978515625000D+09
      C(502)= -0.59980822587575874328613281250000000D+10
      C(503)= -0.12076073882756931304931640625000000D+11
      C(504)= -0.10871501059298934936523437500000000D+11
      C(505)= -0.10896279324337150573730468750000000D+11
      C(506)=  0.46002879628757658004760742187500000D+10
      C(507)= -0.46989731472027177810668945312500000D+10
      C(508)= -0.59841589577072627842426300048828125D+08
      C(509)= -0.26283896007176036834716796875000000D+11
      C(510)= -0.24562970017198402404785156250000000D+11
      C(511)= -0.85852932702872600555419921875000000D+10
      C(512)= -0.16808780421844949722290039062500000D+11
      C(513)= -0.32038951357293281555175781250000000D+11
      C(514)=  0.16231151686533967971801757812500000D+11
      C(515)= -0.14677607548257818222045898437500000D+11
      C(516)= -0.18746854165538272857666015625000000D+11
      C(517)=  0.47800070929386882781982421875000000D+10
      C(518)= -0.17792000425836826324462890625000000D+11
      C(519)= -0.45748450484020133972167968750000000D+11
      C(520)= -0.32158776679087924957275390625000000D+11
      C(521)= -0.18272470815197628021240234375000000D+11
      C(522)= -0.25366309188506515502929687500000000D+11
      C(523)= -0.30543054484139621734619140625000000D+11
      C(524)= -0.43358739100590492248535156250000000D+11
      C(525)=  0.51347979421443305969238281250000000D+11
      C(526)=  0.92346695435838058471679687500000000D+11
      C(527)=  0.49568400874102371215820312500000000D+11
      C(528)=  0.29022040659422279357910156250000000D+11
      C(529)=  0.37162945604107681274414062500000000D+11
      C(530)=  0.42444807790407249450683593750000000D+11
      C(531)=  0.44432607289735206604003906250000000D+11
      C(532)=  0.82330478109204574584960937500000000D+11
      C(533)=  0.36149717767821624755859375000000000D+11
      C(534)=  0.36494202904803056716918945312500000D+10
      C(535)= -0.23537990368495088070631027221679688D+08
      C(536)= -0.72605218328451786041259765625000000D+10
      C(537)= -0.10209566950525846481323242187500000D+11
      C(538)= -0.95606526915203113555908203125000000D+10
      C(539)= -0.10313353897302378714084625244140625D+09
      C(540)=  0.16919684343513545989990234375000000D+11
      C(541)=  0.15076691808049627304077148437500000D+11
      C(542)= -0.10469933711193012237548828125000000D+11
      C(543)= -0.24994355708433197021484375000000000D+11
      C(544)=  0.49327366006888580322265625000000000D+11
      C(545)=  0.36435168746301597595214843750000000D+11
      C(546)= -0.23832649886601281166076660156250000D+10
      C(547)= -0.21860921661070201873779296875000000D+11
      C(548)=  0.98730802730542106628417968750000000D+10
      C(549)= -0.29060188224483882904052734375000000D+11
      C(550)= -0.50661463078248901367187500000000000D+11
      C(551)= -0.20442268408339093017578125000000000D+12
      C(552)=  0.68996546902305099487304687500000000D+11
      C(553)=  0.26714926229340400695800781250000000D+11
      C(554)= -0.30728873837392311096191406250000000D+10
      C(555)= -0.66592974690949020385742187500000000D+11
      C(556)=  0.37982109015402359962463378906250000D+10
      C(557)= -0.16806584140753700256347656250000000D+11
      C(558)= -0.28951420001396686553955078125000000D+11
      C(559)=  0.35755499834345687866210937500000000D+11
      C(560)=  0.26290338955577404022216796875000000D+11
      C(561)= -0.43303391318008697509765625000000000D+11
      C(562)= -0.83411650601432327270507812500000000D+11
      C(563)=  0.31408363312206375122070312500000000D+11
      C(564)=  0.11579226580831044006347656250000000D+12
      C(565)=  0.57327868543074401855468750000000000D+11
      C(566)= -0.64981591660914764404296875000000000D+10
      C(567)= -0.46343730801630790710449218750000000D+11
      C(568)= -0.19768390701701015472412109375000000D+11
      C(569)=  0.93531154325063335895538330078125000D+09
      C(570)=  0.73885230458750030517578125000000000D+11
      C(571)=  0.96307788460641464233398437500000000D+11
      C(572)=  0.34967261347292350769042968750000000D+11
      C(573)= -0.27131094453837448120117187500000000D+11
      C(574)= -0.46322603019207977294921875000000000D+11
      C(575)=  0.10999981986685424804687500000000000D+12
      C(576)= -0.95062500413267929077148437500000000D+11
      C(577)= -0.40983571096229904174804687500000000D+11
      C(578)= -0.13769187112317836761474609375000000D+11
      C(579)= -0.71036455072294891357421875000000000D+11
      C(580)= -0.82447348675430135726928710937500000D+10
      C(581)=  0.11810752464405607604980468750000000D+12
      C(582)=  0.12290398100420762634277343750000000D+12
      C(583)=  0.41222009549276893615722656250000000D+11
      C(584)= -0.13183228280293790817260742187500000D+11
      C(585)= -0.13478674275350196838378906250000000D+12
      C(586)=  0.53337520082398773193359375000000000D+11
      C(587)=  0.57511616746661481857299804687500000D+10
      C(588)= -0.28030917590958049774169921875000000D+11
      C(589)=  0.96887794632030609130859375000000000D+11
      C(590)=  0.15615181064232595825195312500000000D+12
      C(591)=  0.87932978350383026123046875000000000D+11
      C(592)=  0.17500896139078323364257812500000000D+11
      C(593)= -0.97581732066706642508506774902343750D+07
      C(594)= -0.46386645058960533142089843750000000D+11
      C(595)= -0.19943471528077709960937500000000000D+12
      C(596)= -0.12233156160978366088867187500000000D+12
      C(597)= -0.11245911143809577941894531250000000D+11
      C(598)= -0.42531187994435623168945312500000000D+11
      C(599)= -0.10022194547626017761230468750000000D+12
      C(600)= -0.97230160530431930541992187500000000D+11
      C(601)= -0.21856506855250964355468750000000000D+12
      C(602)= -0.78776051902417434692382812500000000D+11
      C(603)= -0.40145360330950492858886718750000000D+11
      C(604)= -0.75896446081419143676757812500000000D+11
      C(605)= -0.57602124702991813659667968750000000D+11
      C(606)= -0.25036789754443538665771484375000000D+11
      C(607)=  0.40420008383647141456604003906250000D+10
      C(608)=  0.24087900131124515533447265625000000D+11
      C(609)=  0.51405996897093589782714843750000000D+11
      C(610)=  0.10672460580845082092285156250000000D+12
      C(611)=  0.10066261303832128906250000000000000D+12
      C(612)=  0.16450463607114697265625000000000000D+12
      C(613)=  0.19181402847093246459960937500000000D+12
      C(614)=  0.19975979028908975219726562500000000D+12
      C(615)=  0.11936489379194586181640625000000000D+12
      C(616)= -0.64793935619781326293945312500000000D+11
      C(617)=  0.47620749334638854980468750000000000D+11
      C(618)= -0.66662160459517471313476562500000000D+11
      C(619)=  0.58492732899867233276367187500000000D+11
      C(620)=  0.60823093119128974914550781250000000D+11
      C(621)= -0.55065402179831207275390625000000000D+11
      C(622)= -0.27201666041498298645019531250000000D+11
      C(623)=  0.94669668880624481201171875000000000D+11
      C(624)=  0.17139479776787965774536132812500000D+11
      C(625)= -0.78719448574301467895507812500000000D+11
      C(626)=  0.87527122473882102966308593750000000D+10
      C(627)=  0.95683779863056030273437500000000000D+11
      C(628)= -0.25101812657597565650939941406250000D+10
      C(629)= -0.99500741018076370239257812500000000D+11
      C(630)= -0.27090080230252944946289062500000000D+11
      C(631)=  0.40505200552217269897460937500000000D+11
      C(632)= -0.11586286827718206405639648437500000D+11
      C(633)= -0.10427035791421018600463867187500000D+11
      C(634)=  0.20947805570488788604736328125000000D+11
      C(635)=  0.88342444701924850463867187500000000D+11
      C(636)= -0.29294386872265357971191406250000000D+11
      C(637)= -0.19821879711463375854492187500000000D+12
      C(638)= -0.92458618075056533813476562500000000D+11
      C(639)=  0.16015201278539828491210937500000000D+12
      C(640)= -0.11384106885672342300415039062500000D+11
      C(641)= -0.11921417900208535766601562500000000D+12
      C(642)=  0.14250767837389617919921875000000000D+12
      C(643)=  0.64485686991057144165039062500000000D+11
      C(644)= -0.16852053582835287475585937500000000D+12
      C(645)= -0.54796625121961898803710937500000000D+11
      C(646)=  0.98348519623145660400390625000000000D+11
      C(647)= -0.47084248296753211975097656250000000D+11
      C(648)= -0.15646574029084426879882812500000000D+12
      C(649)=  0.20713411464600738525390625000000000D+11
      C(650)=  0.17150914717605160522460937500000000D+12
      C(651)=  0.20973005636334018707275390625000000D+11
      C(652)=  0.29933749445697747802734375000000000D+12
      C(653)= -0.27250931265956081390380859375000000D+11
      C(654)= -0.88854233376638442993164062500000000D+11
      C(655)=  0.18989069942469604492187500000000000D+12
      C(656)=  0.13576965564735919189453125000000000D+12
      C(657)= -0.16629702688861593627929687500000000D+12
      C(658)= -0.16162921283864990234375000000000000D+12
      C(659)=  0.90376240896022628784179687500000000D+11
      C(660)= -0.42373908027897689819335937500000000D+11
      C(661)= -0.28026636729818713378906250000000000D+12
      C(662)=  0.46500674340299865722656250000000000D+11
      C(663)=  0.18785297180318548583984375000000000D+12
      C(664)= -0.17325768956525048828125000000000000D+12
      C(665)= -0.37184018468158343505859375000000000D+12
      C(666)= -0.81667252664582260131835937500000000D+11
      C(667)=  0.15758213319571328735351562500000000D+12
      C(668)= -0.30177853412030396461486816406250000D+10
      C(669)=  0.35061733847437652587890625000000000D+12
      C(670)=  0.12043377000294517517089843750000000D+12
      C(671)= -0.26708015968569119262695312500000000D+12
      C(672)= -0.13022367096759146118164062500000000D+12
      C(673)=  0.29417291992254028320312500000000000D+12
      C(674)=  0.32294801960450103759765625000000000D+12
      C(675)= -0.56464096752304946899414062500000000D+11
      C(676)= -0.17792504521127331542968750000000000D+12
      C(677)=  0.15158814313549984741210937500000000D+12
      C(678)=  0.39097232068814038085937500000000000D+12
      C(679)= -0.21908639981543408203125000000000000D+12
      C(680)= -0.15132133333851513671875000000000000D+12
      C(681)=  0.33936710071118480682373046875000000D+11
      C(682)= -0.21527594285200125122070312500000000D+12
      C(683)= -0.25702887361690682983398437500000000D+12
      C(684)=  0.12996233738567180004963574901921675D+01
      C(685)= -0.16386102288346686695064136074506678D+01
      C(686)= -0.27128368059559196693794613786110403D-03
      C(687)=  0.20579411910883176339837064006133005D+01
      C(688)=  0.18714943894577873439999393667676486D+00
      C(689)= -0.13949491893140044673771171801490709D+01
      C(690)=  0.47559977332129500793289622606607736D-01
      C(691)=  0.71719281578020876999346455704653636D-01
      C(692)=  0.15924260343128479600061098153673811D+00
      C(693)= -0.92829802336344964714953675866127014D+04
      C(694)=  0.75087525521023290586697385151637718D+00
      C(695)=  0.87597866173963467861796061697532423D+00
      C(696)=  0.32701619945812785417160739598330110D+01
      C(697)=  0.66239569531052266970760911135585047D+00
      C(698)=  0.25246752272782957415842020054697059D+00
      C(699)=  0.62293667456810697391489384244778194D+00
      C(700)=  0.21117733339362274591621826402842999D+01
      C(701)=  0.16935854204476723516847869177581742D+01
      C(702)=  0.11550466528617360228992083648336120D+01
      C(703)=  0.39826058705040173757438992652168963D+00
      C(704)=  0.11716179437278677610834165534470230D+01
      C(705)=  0.12741529191506888452067869366146624D+01

      BSORDER(1)= 10

      POLORDER=  26

      DO I=1,DEG
        NCBAS(I)=0
        NCBAS(I)=2*BSORDER(I)+2
      END DO

      CALL POLNC(POLORDER,MOLTYP,NCPOL)

      IF (NC.NE.(NCPOL+SUM(NCBAS))) THEN 
        WRITE(*,*) "PROBLEMS IN DEFINING PROPER NUMBER OF COEFFICIENTS"
        WRITE(*,*) "TOTAL NUMBER OF COEFFS ARE NOT SUMMING UP CORRECTLY"
        STOP
      END IF

      ALLOCATE(POL(NCPOL))
      ALLOCATE(DVDY1(NCPOL),DVDY2(NCPOL),DVDY3(NCPOL))

      DO I=1,NCPOL
        POL(I)=0.00D+00
        DVDY1(I)=0.00D+00
        DVDY2(I)=0.00D+00
        DVDY3(I)=0.00D+00
      END DO

      DO I=1,NX
        Y(I)=0.0D+00
        DYDR(I)=0.0D+00
        DVDR(I)=0.0D+00
      END DO

      SUMC=NCPOL
      DO I=1,DEG
        ALLOCATE(BS(NCBAS(I)))
        DO J=1,NCBAS(I)
          BS(J)=0.0D+00
        END DO
        K=SUMC
        DO J=1,NCBAS(I)
          K=K+1
          BS(J)=C(K)
        END DO

!######
! A3-TYPE
!######
        IF (DEG.EQ.1) THEN
          DO O=1,3 
            CALL BASIS_CONTRACT(1,BSORDER(1),BS,R(O),Y(O))

!###### CALCULATING ANALYTIC DERIVATIVES OF Y WITH RESPECT TO R IF DER=.TRUE.
            
            IF (DER) THEN
              CALL DBASIS_CONTRACT(1,BSORDER(1),BS,R(O),DYDR(O))
            END IF

!######
          END DO
        END IF

        SUMC=SUMC+NCBAS(I)
        DEALLOCATE(BS)
      END DO

      TOTNUM=0
      S=0
      DO M=0,POLORDER
        MNUM=0
        DO I=0,M
          DO J=0,(M-I)
            K=M-I-J
            S=I+J+K
            IF (S.NE.I .AND. S.NE.J .AND. S.NE.K) THEN

              IF (MOLTYP.EQ."ABC") THEN  

                TOTNUM=TOTNUM+1
                MNUM=MNUM+1

                CALL PERMUTABC(I,J,K,P,ID)

                DO L=1,ID

                  POL(TOTNUM)=POL(TOTNUM)+&
     &               (Y(1)**(P(1,L))*Y(2)**(P(2,L))*Y(3)**(P(3,L)))

!###### CALCULATING ANALYTIC DERIVATIVES OF V WITH RESPECT TO Y IF DER=.TRUE.

                      IF (DER) THEN
             
                        DVDY1(TOTNUM)=DVDY1(TOTNUM)+&
     &                 (DBLE(P(1,L))*Y(1)**(P(1,L)-1)*Y(2)**(P(2,L))*Y(3)**(P(3,L))) 

                        DVDY2(TOTNUM)=DVDY2(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*DBLE(P(2,L))*Y(2)**(P(2,L)-1)*Y(3)**(P(3,L)))    

                        DVDY3(TOTNUM)=DVDY3(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*Y(2)**(P(2,L))*DBLE(P(3,L))*Y(3)**(P(3,L)-1)) 
             
                      END IF

!######
                END DO

                POL(TOTNUM)=C(TOTNUM)*POL(TOTNUM)/DBLE(ID)

!###### MULTIPLYING THE CONTRIBUTIONS OF DVDY BY THE POLYNOMIAL COEFFS. IF DER=.TRUE.

                IF (DER) THEN
                  DVDY1(TOTNUM)=C(TOTNUM)*DVDY1(TOTNUM)/DBLE(ID)
                  DVDY2(TOTNUM)=C(TOTNUM)*DVDY2(TOTNUM)/DBLE(ID)
                  DVDY3(TOTNUM)=C(TOTNUM)*DVDY3(TOTNUM)/DBLE(ID)
                END IF

!######
              ELSE IF (MOLTYP.EQ."AB2") THEN 

                IF (J.LE.K) THEN 

                  TOTNUM=TOTNUM+1
                  MNUM=MNUM+1

                  CALL PERMUTAB2(I,J,K,P,ID)
                   
                  DO L=1,ID

                    POL(TOTNUM)=POL(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*Y(2)**(P(2,L))*Y(3)**(P(3,L)))

!###### CALCULATING ANALYTIC DERIVATIVES OF V WITH RESPECT TO Y IF DER=.TRUE.

                      IF (DER) THEN
             
                        DVDY1(TOTNUM)=DVDY1(TOTNUM)+&
     &                 (DBLE(P(1,L))*Y(1)**(P(1,L)-1)*Y(2)**(P(2,L))*Y(3)**(P(3,L))) 

                        DVDY2(TOTNUM)=DVDY2(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*DBLE(P(2,L))*Y(2)**(P(2,L)-1)*Y(3)**(P(3,L)))    

                        DVDY3(TOTNUM)=DVDY3(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*Y(2)**(P(2,L))*DBLE(P(3,L))*Y(3)**(P(3,L)-1)) 
             
                      END IF

!######
                  END DO

                  POL(TOTNUM)=C(TOTNUM)*POL(TOTNUM)/DBLE(ID)

!###### MULTIPLYING THE CONTRIBUTIONS OF DVDY BY THE POLYNOMIAL COEFFS. IF DER=.TRUE.

                  IF (DER) THEN
                    DVDY1(TOTNUM)=C(TOTNUM)*DVDY1(TOTNUM)/DBLE(ID)
                    DVDY2(TOTNUM)=C(TOTNUM)*DVDY2(TOTNUM)/DBLE(ID)
                    DVDY3(TOTNUM)=C(TOTNUM)*DVDY3(TOTNUM)/DBLE(ID)
                  END IF

!######
                END IF    
         
              ELSE IF (MOLTYP.EQ."A3") THEN

                IF (I.LE.J .AND. J.LE.K) THEN

                  TOTNUM=TOTNUM+1
                  MNUM=MNUM+1

                  CALL PERMUTA3(I,J,K,P,ID)
                   
                  DO L=1,ID

                    POL(TOTNUM)=POL(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*Y(2)**(P(2,L))*Y(3)**(P(3,L)))

!###### CALCULATING ANALYTIC DERIVATIVES OF V WITH RESPECT TO Y IF DER=.TRUE.

                      IF (DER) THEN
             
                        DVDY1(TOTNUM)=DVDY1(TOTNUM)+&
     &                 (DBLE(P(1,L))*Y(1)**(P(1,L)-1)*Y(2)**(P(2,L))*Y(3)**(P(3,L))) 

                        DVDY2(TOTNUM)=DVDY2(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*DBLE(P(2,L))*Y(2)**(P(2,L)-1)*Y(3)**(P(3,L)))    

                        DVDY3(TOTNUM)=DVDY3(TOTNUM)+&
     &                 (Y(1)**(P(1,L))*Y(2)**(P(2,L))*DBLE(P(3,L))*Y(3)**(P(3,L)-1)) 
             
                      END IF

!######
                  END DO

                  POL(TOTNUM)=C(TOTNUM)*POL(TOTNUM)/DBLE(ID)

!###### MULTIPLYING THE CONTRIBUTIONS OF DVDY BY THE POLYNOMIAL COEFFS. IF DER=.TRUE.

                  IF (DER) THEN
                    DVDY1(TOTNUM)=C(TOTNUM)*DVDY1(TOTNUM)/DBLE(ID)
                    DVDY2(TOTNUM)=C(TOTNUM)*DVDY2(TOTNUM)/DBLE(ID)
                    DVDY3(TOTNUM)=C(TOTNUM)*DVDY3(TOTNUM)/DBLE(ID)
                  END IF

!######
                END IF

              END IF

            END IF
          END DO
        END DO

      END DO

      POT=SUM(POL)*REPDAMP(NX,R)

!###### CALCULATING ANALYTIC DERIVATIVES OF V WITH RESPECT TO R IF DER=.TRUE.

      IF (DER) THEN
        DVDR(1)=SUM(DVDY1)*DYDR(1)
        DVDR(2)=SUM(DVDY2)*DYDR(2)
        DVDR(3)=SUM(DVDY3)*DYDR(3)
      ELSE 
        DVDR(1)=1000
        DVDR(2)=1000
        DVDR(3)=1000
      END IF

!######

      DEALLOCATE(POL)
      DEALLOCATE(DVDY1,DVDY2,DVDY3)

      RETURN
      END

!####################################################################################

      SUBROUTINE CARTDERPES3BD(X,DVDX)
      IMPLICIT NONE 
      INTEGER :: I
      INTEGER, PARAMETER :: NATOM=3     
      DOUBLE PRECISION, DIMENSION(3*NATOM) :: X
      DOUBLE PRECISION, DIMENSION(3*NATOM) :: DVDX,O
      DOUBLE PRECISION, DIMENSION(NATOM) :: Y,R,DVDR
      DOUBLE PRECISION :: V
!
!     This subprogram uses the chain rule to calculate the derivatives of the
!     energy with respect to the cartesian coordinates from the derivatives
!     with respect to the internal coordinates for a three-body system.
!     The convention assumed in this program is as follows:
!
!     R(1) = R(A-B)
!     R(2) = R(A-C)
!     R(3) = R(B-C)
!     X(1) - X(3) : X, Y, Z for atom A
!     X(4) - X(6) : X, Y, Z for atom B
!     X(7) - X(9) : X, Y, Z for atom C
!
      CALL CART2INTER3BD(X,O,3*NATOM)

      R(1)=O(1)
      R(2)=O(2)
      R(3)=O(3)

      CALL CHIPR_TRIAT(R,V,.TRUE.,DVDR) 

      DO I=1,3
        Y(I)=DVDR(I)/R(I)
      END DO

      DVDX(1)=-Y(1)*(X(4)-X(1))-Y(2)*(X(7)-X(1)) 
      DVDX(2)=-Y(1)*(X(5)-X(2))-Y(2)*(X(8)-X(2)) 
      DVDX(3)=-Y(1)*(X(6)-X(3))-Y(2)*(X(9)-X(3)) 
      DVDX(4)= Y(1)*(X(4)-X(1))-Y(3)*(X(7)-X(4)) 
      DVDX(5)= Y(1)*(X(5)-X(2))-Y(3)*(X(8)-X(5))
      DVDX(6)= Y(1)*(X(6)-X(3))-Y(3)*(X(9)-X(6))
      DVDX(7)= Y(2)*(X(7)-X(1))+Y(3)*(X(7)-X(4))
      DVDX(8)= Y(2)*(X(8)-X(2))+Y(3)*(X(8)-X(5))
      DVDX(9)= Y(2)*(X(9)-X(3))+Y(3)*(X(9)-X(6))

      RETURN
      END

!####################################################################################

      SUBROUTINE CART2INTER3BD(X,R,NTA)
      IMPLICIT NONE
      INTEGER, PARAMETER :: NA=3,NT=3*NA
      INTEGER :: NTA,I,K,J
      DOUBLE PRECISION, DIMENSION (NT):: X,R
      K=0
      DO I=1,NTA,3
       DO J=I,NTA,3
        IF(I.NE.J)THEN
         K=K+1
         R(K)=SQRT((X(I)-X(J))**2+(X(I+1)-X(J+1))**2+&
     &   (X(I+2)-X(J+2))**2)
        END IF
       END DO
      END DO
      RETURN
      END

!################################################################################

      DOUBLE PRECISION FUNCTION REPDAMP(NX,R)
      IMPLICIT NONE
      INTEGER :: I,NX
      DOUBLE PRECISION, DIMENSION(NX) :: R,H
      DOUBLE PRECISION :: KAPPA, XI, R0
      R0=0.5D+00
      KAPPA=100.0D+00
      XI=10.0D+00
      DO I=1,NX
        H(I)=0.5D+00*(1.00D+00+TANH(KAPPA*(R(I)-R0)))
      END DO
      REPDAMP=(PRODUCT(H))**(XI)      
      END FUNCTION

!################################################################################      
      
      SUBROUTINE PERMUTABC(I,J,K,P,ID)
      IMPLICIT NONE
      INTEGER :: I,J,K
      INTEGER :: L,M,ID
      INTEGER, DIMENSION(3) :: INTER
      INTEGER, DIMENSION(3,6) :: P

      DO L=1,3 
        DO M=1,6
          P(L,M)=0
        END DO
      END DO

      INTER(1)=I
      INTER(2)=J
      INTER(3)=K

      ID=1

      P(1,1)=INTER(1)
      P(2,1)=INTER(2)
      P(3,1)=INTER(3) 

      RETURN
      END

!################################################################################      
      
      SUBROUTINE PERMUTAB2(I,J,K,P,ID)
      IMPLICIT NONE
      INTEGER :: I,J,K
      INTEGER :: L,M,ID
      INTEGER, DIMENSION(3) :: INTER
      INTEGER, DIMENSION(3,6) :: P

      DO L=1,3 
        DO M=1,6
          P(L,M)=0
        END DO
      END DO
      
      INTER(1)=I
      INTER(2)=J
      INTER(3)=K
      
      IF (J.NE.K) THEN  
 
        ID=2

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)      

        P(1,2)=INTER(1)
        P(2,2)=INTER(3)
        P(3,2)=INTER(2) 

       ELSE 

        ID=1

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)

       END IF

      RETURN 
      END 

!################################################################################      
      
      SUBROUTINE PERMUTA3(I,J,K,P,ID)
      IMPLICIT NONE
      INTEGER :: I,J,K
      INTEGER :: L,M,ID
      INTEGER, DIMENSION(3) :: INTER
      INTEGER, DIMENSION(3,6) :: P

      DO L=1,3 
        DO M=1,6
          P(L,M)=0
        END DO
      END DO
      
      INTER(1)=I
      INTER(2)=J
      INTER(3)=K
      
      IF (I.EQ.J.AND.J.EQ.K.AND.I.EQ.K) THEN
      
        ID=1

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)  
        
      ELSE IF (I.NE.J.AND.J.NE.K.AND.I.NE.K) THEN   

        ID=6

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)      

        P(1,2)=INTER(2)
        P(2,2)=INTER(1)
        P(3,2)=INTER(3)  

        P(1,3)=INTER(3)
        P(2,3)=INTER(2)
        P(3,3)=INTER(1) 

        P(1,4)=INTER(1)
        P(2,4)=INTER(3)
        P(3,4)=INTER(2) 

        P(1,5)=P(1,2)
        P(2,5)=P(3,2)
        P(3,5)=P(2,2)  

        P(1,6)=P(1,3)
        P(2,6)=P(3,3)
        P(3,6)=P(2,3)  
        
      ELSE IF (I.EQ.J) THEN       
     
        ID=3     

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3) 

        P(1,2)=INTER(3)
        P(2,2)=INTER(2)
        P(3,2)=INTER(1) 

        P(1,3)=INTER(1)
        P(2,3)=INTER(3)
        P(3,3)=INTER(2)
        
      ELSE IF (J.EQ.K) THEN       
                    
        ID=3     

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)      

        P(1,2)=INTER(2)
        P(2,2)=INTER(1)
        P(3,2)=INTER(3)  

        P(1,3)=INTER(3)
        P(2,3)=INTER(2)
        P(3,3)=INTER(1) 
        
      ELSE IF (I.EQ.K) THEN    
  
        ID=3  

        P(1,1)=INTER(1)
        P(2,1)=INTER(2)
        P(3,1)=INTER(3)      

        P(1,2)=INTER(2)
        P(2,2)=INTER(1)
        P(3,2)=INTER(3)  

        P(1,3)=INTER(1)
        P(2,3)=INTER(3)
        P(3,3)=INTER(2)        
    
      END IF

      RETURN 
      END 

!################################################################################ 

      SUBROUTINE POLNC(ORDER,MOLTYP,NC)
      IMPLICIT NONE
      INTEGER :: I,J,K,L,M,S
      INTEGER :: NC,MNUM,ORDER
      CHARACTER(LEN=3) :: MOLTYP

      NC=0
      S=0

      DO M=0,ORDER
        MNUM=0
        DO I=0,M
          DO J=0,(M-I)
            K=M-I-J
            S=I+J+K
            IF (S.NE.I .AND. S.NE.J .AND. S.NE.K) THEN
 
              IF (MOLTYP.EQ."ABC") THEN  

                NC=NC+1
                MNUM=MNUM+1

              ELSE IF (MOLTYP.EQ."AB2") THEN 

                IF (J.LE.K) THEN 

                  NC=NC+1
                  MNUM=MNUM+1

                END IF    
        
              ELSE IF (MOLTYP.EQ."A3") THEN

                IF (I.LE.J .AND. J.LE.K) THEN

                  NC=NC+1
                  MNUM=MNUM+1

                END IF

              END IF

            END IF
          END DO
        END DO
      END DO

      RETURN
      END

!######################################################################################################

      SUBROUTINE BASIS_CONTRACT(DEG,M,C,R,YVAL)
      IMPLICIT NONE
      INTEGER :: I,J,DEG
      INTEGER :: M
      DOUBLE PRECISION :: RREF0,ZETA
      DOUBLE PRECISION, DIMENSION(2*M+2) :: C
      DOUBLE PRECISION, DIMENSION(M) :: GAMA,VAL
      DOUBLE PRECISION :: R,YVAL

      DO I=1,M
        GAMA(I)=C(M+I)
      END DO

      RREF0=C(2*M+1)
      ZETA=C(2*M+2)

      DO I=1,M-1
        CALL PHISECBASIS(DEG,I,RREF0,ZETA,GAMA(I),1,R,VAL(I))
      END DO

      DO I=M,M
        CALL PHICSECBASIS(DEG,I,RREF0,ZETA,GAMA(I),1,6,R,VAL(I))
      END DO

      YVAL=0.00D+00

      DO J=1,M
        YVAL=YVAL+C(J)*VAL(J)
      END DO

      RETURN
      END

!######################################################################################################

      SUBROUTINE PHISECBASIS(DEG,IND,RREF0,ZETA,GAMA,ETA,R,VAL)
      IMPLICIT NONE
      INTEGER :: DEG, IND, ETA
      DOUBLE PRECISION :: RREF0, ZETA, RREFIND 
      DOUBLE PRECISION :: GAMA, R, VAL, RHO
      DOUBLE PRECISION :: SECH, ORIG
      RREFIND=ORIG(IND,ZETA,RREF0)
      RHO=(R-RREFIND)
      VAL=(SECH(GAMA*RHO))**(DBLE(ETA))
      RETURN
      END

!######################################################################################################

      SUBROUTINE PHICSECBASIS(DEG,IND,RREF0,ZETA,GAMA,ETA,LR,R,VAL)
      IMPLICIT NONE
      INTEGER :: DEG, IND, LR, ETA
      DOUBLE PRECISION :: RREF0, ZETA, RREFIND 
      DOUBLE PRECISION :: GAMA, R, VAL, RHO
      DOUBLE PRECISION :: SECH, BETA, FAC, ORIG
      BETA=1.00D+00/5.0D+00
      RREFIND=ORIG(IND,ZETA,RREF0)
      RHO=(R-RREFIND)
      FAC=(TANH(BETA*R)/R)**(DBLE(LR))
      VAL=FAC*(SECH(GAMA*RHO))**(DBLE(ETA))
      RETURN
      END

!######################################################################################################

      SUBROUTINE DBASIS_CONTRACT(DEG,M,C,R,DYDR)
      IMPLICIT NONE
      INTEGER :: I,J,DEG
      INTEGER :: M
      DOUBLE PRECISION :: RREF0,ZETA
      DOUBLE PRECISION, DIMENSION(2*M+2) :: C
      DOUBLE PRECISION, DIMENSION(M) :: GAMA,DPHIDR
      DOUBLE PRECISION :: R,DYDR

      DO I=1,M
        GAMA(I)=C(M+I)
      END DO

      RREF0=C(2*M+1)
      ZETA=C(2*M+2)

      DO I=1,M-1
        CALL DPHISECBASIS(DEG,I,RREF0,ZETA,GAMA(I),1,R,DPHIDR(I))
      END DO

      DO I=M,M
        CALL DPHICSECBASIS(DEG,I,RREF0,ZETA,GAMA(I),1,6,R,DPHIDR(I))
      END DO

      DYDR=0.00D+00

      DO J=1,M
        DYDR=DYDR+C(J)*DPHIDR(J)
      END DO

      RETURN
      END

!######################################################################################################

      SUBROUTINE DPHISECBASIS(DEG,IND,RREF0,ZETA,GAMA,ETA,R,DPHIDR)
      IMPLICIT NONE
      INTEGER :: DEG, IND, ETA
      DOUBLE PRECISION :: RREF0, ZETA, RREFIND 
      DOUBLE PRECISION :: GAMA, R, VAL, RHO
      DOUBLE PRECISION :: SECH, ORIG
      DOUBLE PRECISION :: PART1,PART2
      DOUBLE PRECISION :: DPHIDR
      RREFIND=ORIG(IND,ZETA,RREF0)
      RHO=(R-RREFIND)
      PART1=(SECH(GAMA*RHO))**(DBLE(ETA))
      PART2=(TANH(GAMA*RHO))
      DPHIDR=-(DBLE(ETA))*GAMA*PART1*PART2
      RETURN
      END

!######################################################################################################

      SUBROUTINE DPHICSECBASIS(DEG,IND,RREF0,ZETA,GAMA,ETA,LR,R,DPHIDR)
      IMPLICIT NONE
      INTEGER :: DEG, IND, LR, ETA
      DOUBLE PRECISION :: RREF0, ZETA, RREFIND 
      DOUBLE PRECISION :: GAMA, R, VAL, RHO
      DOUBLE PRECISION :: SECH, BETA, FAC, ORIG
      DOUBLE PRECISION :: FAC1PART1,FAC2PART1
      DOUBLE PRECISION :: FAC3PART1,FAC1PART2
      DOUBLE PRECISION :: FAC2PART2,FAC3PART2
      DOUBLE PRECISION :: PART1,PART2
      DOUBLE PRECISION :: DPHIDR
      BETA=1.00D+00/5.0D+00
      RREFIND=ORIG(IND,ZETA,RREF0)
      RHO=(R-RREFIND)
      FAC1PART1=(TANH(BETA*R)/R)**(DBLE(LR-1))
      FAC2PART1=(BETA*(SECH(BETA*R))**(2)/R)-(TANH(BETA*R)/R**2)
      FAC3PART1=(SECH(GAMA*RHO))**(DBLE(ETA))
      PART1=(DBLE(LR))*FAC1PART1*FAC2PART1*FAC3PART1
      FAC1PART2=(SECH(GAMA*RHO))**(DBLE(ETA))
      FAC2PART2=(TANH(GAMA*RHO))
      FAC3PART2=(TANH(BETA*R)/R)**(DBLE(LR))
      PART2=-(DBLE(ETA))*GAMA*FAC1PART2*FAC2PART2*FAC3PART2
      DPHIDR=PART1+PART2
      RETURN
      END

!######################################################################################################

      DOUBLE PRECISION FUNCTION ORIG(IND,ZETA,RREF0)
      IMPLICIT NONE
      INTEGER :: IND
      DOUBLE PRECISION :: ZETA,RREF0
      ORIG=ZETA*(RREF0)**(DBLE(IND)-1.0D+00)
      RETURN
      END

!######################################################################################################

      DOUBLE PRECISION FUNCTION SECH(X)
      IMPLICIT NONE
      DOUBLE PRECISION :: X
      SECH=1.00D+00/(COSH(X))      
      RETURN
      END
